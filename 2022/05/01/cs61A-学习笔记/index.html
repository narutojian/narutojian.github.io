<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <link rel="manifest" href="/images/site.webmanifest">
  <meta name="google-site-verification" content="<meta name="google-site-verification" content="flKSt7LiyY7jUhlnv-ICYGB3DW183M7aZEM_MJ0LyAM" />">
  <meta name="msvalidate.01" content="<meta name="msvalidate.01" content="551E330FEDD04710DC9B83BE6974A021" />">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/all.min.css" integrity="sha256-jTIdiMuX/e3DGJUGwl3pKSxuc6YOuqtJYkM0bGQESA4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"narutojian.github.io","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.10.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="整理学习cs61A的笔记">
<meta property="og:type" content="article">
<meta property="og:title" content="2021 fall cs61A 学习笔记">
<meta property="og:url" content="http://narutojian.github.io/2022/05/01/cs61A-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="岁月的童话">
<meta property="og:description" content="整理学习cs61A的笔记">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://image-bed.limit-infinite.top/images/blog/2023-01-30-031305.png">
<meta property="og:image" content="http://image-bed.limit-infinite.top/images/blog/082935.png">
<meta property="og:image" content="http://image-bed.limit-infinite.top/images/blog/2023-01-30-032316.png">
<meta property="og:image" content="http://image-bed.limit-infinite.top/images/blog/2023-01-30-034048.png">
<meta property="og:image" content="http://image-bed.limit-infinite.top/images/blog/2023-02-02-075908.png">
<meta property="article:published_time" content="2022-05-01T13:05:50.000Z">
<meta property="article:modified_time" content="2023-09-24T18:38:22.982Z">
<meta property="article:author" content="秃头的小刺猬">
<meta property="article:tag" content="cs61A">
<meta property="article:tag" content="python">
<meta property="article:tag" content="笔记">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://image-bed.limit-infinite.top/images/blog/2023-01-30-031305.png">


<link rel="canonical" href="http://narutojian.github.io/2022/05/01/cs61A-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://narutojian.github.io/2022/05/01/cs61A-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/","path":"2022/05/01/cs61A-学习笔记/","title":"2021 fall cs61A 学习笔记"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>2021 fall cs61A 学习笔记 | 岁月的童话</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">岁月的童话</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">程序猿，学习，生活</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
        <li class="menu-item menu-item-commonweal"><a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>公益 404</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#building-abstractions-with-functions"><span class="nav-number">1.</span> <span class="nav-text">Building Abstractions with Functions</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#higher-order-functions"><span class="nav-number">1.1.</span> <span class="nav-text">Higher-Order Functions</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#functions-as-arguments"><span class="nav-number">1.1.1.</span> <span class="nav-text">Functions as Arguments</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#functions-as-returned-values"><span class="nav-number">1.1.2.</span> <span class="nav-text">Functions as Returned Values</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#lambda-expressions"><span class="nav-number">1.1.3.</span> <span class="nav-text">Lambda expressions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#function-decorators"><span class="nav-number">1.1.4.</span> <span class="nav-text">Function Decorators</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#recursive-fcuntions"><span class="nav-number">1.2.</span> <span class="nav-text">Recursive Fcuntions</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#mutual-recursion"><span class="nav-number">1.2.0.0.1.</span> <span class="nav-text">mutual recursion</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#building-abstractions-with-data"><span class="nav-number">2.</span> <span class="nav-text">Building Abstractions with Data</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#data-abstraction"><span class="nav-number">2.1.</span> <span class="nav-text">Data Abstraction</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#sequences"><span class="nav-number">2.1.1.</span> <span class="nav-text">Sequences</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#lists"><span class="nav-number">2.1.1.1.</span> <span class="nav-text">Lists</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ranges"><span class="nav-number">2.1.1.2.</span> <span class="nav-text">Ranges</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#strings"><span class="nav-number">2.1.1.3.</span> <span class="nav-text">Strings</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#nesting-lists-%E4%BD%BF%E7%94%A8%E5%8E%9F%E7%94%9F%E7%9A%84sequeece%E6%9E%84%E9%80%A0%E5%A4%8D%E6%9D%82%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="nav-number">2.1.1.4.</span> <span class="nav-text">Nesting lists （使用原生的sequeece构造复杂的数据结构）</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#tree"><span class="nav-number">2.1.1.4.1.</span> <span class="nav-text">Tree</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#linked-list-%E9%93%BE%E8%A1%A8"><span class="nav-number">2.1.1.4.2.</span> <span class="nav-text">Linked list 链表</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sequence-iteration"><span class="nav-number">2.1.2.</span> <span class="nav-text">Sequence Iteration</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mutable-data"><span class="nav-number">2.2.</span> <span class="nav-text">Mutable Data</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#nonlocal"><span class="nav-number">2.2.1.</span> <span class="nav-text">nonlocal</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#implict-sequences"><span class="nav-number">2.3.</span> <span class="nav-text">Implict Sequences</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#iterator"><span class="nav-number">2.3.1.</span> <span class="nav-text">Iterator</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#iterable"><span class="nav-number">2.3.2.</span> <span class="nav-text">Iterable</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#built-in-iterator"><span class="nav-number">2.3.3.</span> <span class="nav-text">Built-in Iterator</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#for-statements"><span class="nav-number">2.3.4.</span> <span class="nav-text">For Statements</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#generators-and-yield-statements"><span class="nav-number">2.3.5.</span> <span class="nav-text">Generators and Yield Statements</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#iterable-interface"><span class="nav-number">2.3.6.</span> <span class="nav-text">Iterable Interface</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#iterator-interface"><span class="nav-number">2.3.7.</span> <span class="nav-text">Iterator Interface</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#object-oriented-programming"><span class="nav-number">2.4.</span> <span class="nav-text">Object-Oriented Programming</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#objects-and-classes"><span class="nav-number">2.4.1.</span> <span class="nav-text">Objects and Classes</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#defining-classes"><span class="nav-number">2.4.2.</span> <span class="nav-text">Defining Classes</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#message-passing-and-dot-expressions"><span class="nav-number">2.4.3.</span> <span class="nav-text">Message Passing and Dot Expressions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#class-attributes"><span class="nav-number">2.4.4.</span> <span class="nav-text">Class Attributes</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#inheritance"><span class="nav-number">2.4.5.</span> <span class="nav-text">Inheritance</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#multiple-inheritance"><span class="nav-number">2.4.6.</span> <span class="nav-text">Multiple Inheritance</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#object-abstraction"><span class="nav-number">2.5.</span> <span class="nav-text">Object Abstraction</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#string-conversion"><span class="nav-number">2.5.1.</span> <span class="nav-text">String Conversion</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#special-methods"><span class="nav-number">2.5.2.</span> <span class="nav-text">Special Methods</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#multiple-representations"><span class="nav-number">2.5.3.</span> <span class="nav-text">Multiple Representations</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#generic-functions"><span class="nav-number">2.5.4.</span> <span class="nav-text">Generic Functions</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#recursive-objects"><span class="nav-number">2.6.</span> <span class="nav-text">Recursive Objects</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#linked-list-class"><span class="nav-number">2.6.1.</span> <span class="nav-text">Linked List Class</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#tree-class"><span class="nav-number">2.6.2.</span> <span class="nav-text">Tree Class</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sets"><span class="nav-number">2.6.3.</span> <span class="nav-text">Sets</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#efficiency"><span class="nav-number">2.7.</span> <span class="nav-text">Efficiency</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#measuring-efficiency"><span class="nav-number">2.7.1.</span> <span class="nav-text">Measuring Efficiency</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#memoization"><span class="nav-number">2.7.2.</span> <span class="nav-text">Memoization</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#decomposition"><span class="nav-number">2.8.</span> <span class="nav-text">Decomposition</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#modules"><span class="nav-number">2.8.1.</span> <span class="nav-text">Modules</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#importing"><span class="nav-number">2.8.1.1.</span> <span class="nav-text">Importing</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#importing-with-alias"><span class="nav-number">2.8.1.2.</span> <span class="nav-text">Importing with alias</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#running-a-module"><span class="nav-number">2.8.1.3.</span> <span class="nav-text">Running a module</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#packages"><span class="nav-number">2.8.2.</span> <span class="nav-text">Packages</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#python-packages"><span class="nav-number">2.8.2.1.</span> <span class="nav-text">Python packages</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#importing-from-a-package"><span class="nav-number">2.8.2.2.</span> <span class="nav-text">Importing from a package</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#installing-packages"><span class="nav-number">2.8.2.3.</span> <span class="nav-text">Installing packages</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#modularity"><span class="nav-number">2.8.3.</span> <span class="nav-text">Modularity</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#modular-design"><span class="nav-number">2.8.3.1.</span> <span class="nav-text">Modular design</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#interpreting-computer-programs"><span class="nav-number">3.</span> <span class="nav-text">Interpreting Computer Programs</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#interpreters-for-languages-with-combination"><span class="nav-number">3.1.</span> <span class="nav-text">Interpreters for Languages with Combination</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#a-scheme-syntax-calculator"><span class="nav-number">3.1.1.</span> <span class="nav-text">A Scheme-Syntax Calculator</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="秃头的小刺猬"
      src="/images/avatar/avatar.jpg">
  <p class="site-author-name" itemprop="name">秃头的小刺猬</p>
  <div class="site-description" itemprop="description">让岁月留下痕迹</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">58</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">37</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">61</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/narutojian" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;narutojian" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdn.jsdelivr.net/npm/@creativecommons/vocabulary@2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://narutojian.github.io/2022/05/01/cs61A-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar/avatar.jpg">
      <meta itemprop="name" content="秃头的小刺猬">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="岁月的童话">
      <meta itemprop="description" content="让岁月留下痕迹">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="2021 fall cs61A 学习笔记 | 岁月的童话">
      <meta itemprop="description" content="整理学习cs61A的笔记">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          2021 fall cs61A 学习笔记
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-05-01 21:05:50" itemprop="dateCreated datePublished" datetime="2022-05-01T21:05:50+08:00">2022-05-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-09-25 02:38:22" itemprop="dateModified" datetime="2023-09-25T02:38:22+08:00">2023-09-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/cs61A/" itemprop="url" rel="index"><span itemprop="name">cs61A</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>39k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>4:19</span>
    </span>
</div>

            <div class="post-description">整理学习cs61A的笔记</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="building-abstractions-with-functions">Building Abstractions with Functions</h1>
<p>用函数构建抽象</p>
<h2 id="higher-order-functions">Higher-Order Functions</h2>
<p>evaluate expression ——是计算这个表达式的意思</p>
<h3 id="functions-as-arguments">Functions as Arguments</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">sum_naturals</span>(<span class="params">n</span>):</span></span><br><span class="line">  			<span class="string">&#x27;&#x27;&#x27;自然数求和</span></span><br><span class="line"><span class="string">  			&#x27;&#x27;&#x27;</span></span><br><span class="line">        total, k = <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> k &lt;= n:</span><br><span class="line">            total, k = total + k, k + <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> total</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sum_naturals(<span class="number">100</span>)</span><br><span class="line"><span class="number">5050</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">sum_cubes</span>(<span class="params">n</span>):</span></span><br><span class="line">  			<span class="string">&#x27;&#x27;&#x27;求立方和</span></span><br><span class="line"><span class="string">  			&#x27;&#x27;&#x27;</span></span><br><span class="line">        total, k = <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> k &lt;= n:</span><br><span class="line">            total, k = total + k*k*k, k + <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> total</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sum_cubes(<span class="number">100</span>)</span><br><span class="line"><span class="number">25502500</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">pi_sum</span>(<span class="params">n</span>):</span></span><br><span class="line">  			<span class="string">&#x27;&#x27;&#x27;求pi</span></span><br><span class="line"><span class="string">  			&#x27;&#x27;&#x27;</span></span><br><span class="line">        total, k = <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> k &lt;= n:</span><br><span class="line">            total, k = total + <span class="number">8</span> / ((<span class="number">4</span>*k-<span class="number">3</span>) * (<span class="number">4</span>*k-<span class="number">1</span>)), k + <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> total</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pi_sum(<span class="number">100</span>)</span><br><span class="line"><span class="number">3.1365926848388144</span></span><br></pre></td></tr></table></figure>
<p>三个函数的功能都是一样的，都是进行求和，但是具体的求法有点不同，可以对其抽象，抽取共同部分。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">summation</span>(<span class="params">n, term</span>):</span></span><br><span class="line">        total, k = <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> k &lt;= n:</span><br><span class="line">            total, k = total + term(k), k + <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> total</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">identity</span>(<span class="params">x</span>):</span></span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">sum_naturals</span>(<span class="params">n</span>):</span></span><br><span class="line">        <span class="keyword">return</span> summation(n, identity)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sum_naturals(<span class="number">10</span>)</span><br><span class="line"><span class="number">55</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>summation(<span class="number">10</span>, square)</span><br><span class="line"><span class="number">385</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">pi_term</span>(<span class="params">x</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">8</span> / ((<span class="number">4</span>*x-<span class="number">3</span>) * (<span class="number">4</span>*x-<span class="number">1</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">pi_sum</span>(<span class="params">n</span>):</span></span><br><span class="line">        <span class="keyword">return</span> summation(n, pi_term)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pi_sum(<span class="number">1e6</span>)</span><br><span class="line"><span class="number">3.141592153589902</span></span><br></pre></td></tr></table></figure>
<h3 id="functions-as-returned-values">Functions as Returned Values</h3>
<p>We can achieve even more expressive power in our programs by creating functions whose returned values are themselves functions.</p>
<p>栗子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">square</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">return</span> x*x</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">successor</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">return</span> x+<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compose1</span>(<span class="params">f,g</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;返回一个函数&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">h</span>(<span class="params">x</span>):</span></span><br><span class="line">        <span class="keyword">return</span> f(g(x))</span><br><span class="line">    <span class="keyword">return</span> h</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;Never called.&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> -x</span><br><span class="line"></span><br><span class="line">square_successor = compose1(square,successor)</span><br><span class="line">result = square_successor(<span class="number">12</span>)</span><br></pre></td></tr></table></figure>
<h3 id="lambda-expressions">Lambda expressions</h3>
<p>In Python, we can create function values on the fly using <code>lambda</code> expressions, which evaluate to unnamed functions. A lambda expression evaluates to a function that has a single return expression as its body. Assignment and control statements are not allowed.</p>
<p>We can understand the structure of a <code>lambda</code> expression by constructing a corresponding English sentence:</p>
<figure>
<img src="http://image-bed.limit-infinite.top/images/blog/2023-01-30-031305.png" alt="lambda expression" /><figcaption aria-hidden="true">lambda expression</figcaption>
</figure>
<h3 id="function-decorators">Function Decorators</h3>
<p>Python provides special syntax to apply higher-order functions as part of executing a <code>def</code> statement, called a <strong>decorator</strong>. Perhaps the most common example is a trace.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">trace</span>(<span class="params">fn</span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">wrapped</span>(<span class="params">x</span>):</span></span><br><span class="line">            print(<span class="string">&#x27;-&gt; &#x27;</span>, fn, <span class="string">&#x27;(&#x27;</span>, x, <span class="string">&#x27;)&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> fn(x)</span><br><span class="line">        <span class="keyword">return</span> wrapped</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>@trace</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">triple</span>(<span class="params">x</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">3</span> * x</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>triple(<span class="number">12</span>)</span><br><span class="line">-&gt;  &lt;function triple at 0x102a39848&gt; ( 12 )</span><br><span class="line"><span class="number">36</span></span><br></pre></td></tr></table></figure>
<p>上述的<code>@trace</code>decorator的作用等同于下面这个代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">triple</span>(<span class="params">x</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">3</span> * x</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>triple = trace(triple)</span><br></pre></td></tr></table></figure>
<p>The decorator symbol <code>@</code> may also be followed by a call expression.</p>
<h2 id="recursive-fcuntions">Recursive Fcuntions</h2>
<h5 id="mutual-recursion">mutual recursion</h5>
<p>As another example of mutual recursion, consider a two-player game in which there are <code>n</code> initial pebbles on a table. The players take turns, removing either one or two pebbles from the table, and the player who removes the final pebble wins. Suppose that Alice and Bob play this game, each using a simple strategy:</p>
<ul>
<li>Alice always removes a single pebble</li>
<li>Bob removes two pebbles if an even number of pebbles is on the table, and one otherwise</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">play_alice</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">0</span>:</span><br><span class="line">        print(<span class="string">&quot;Bob wins!&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        play_bob(n-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">play_bob</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">0</span>:</span><br><span class="line">        print(<span class="string">&quot;Alice wins!&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> is_even(n):</span><br><span class="line">        play_alice(n-<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        play_alice(n-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_even</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> (n-<span class="number">1</span>) == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> is_even((n-<span class="number">1</span>)-<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<h1 id="building-abstractions-with-data">Building Abstractions with Data</h1>
<p>用数据构建抽象</p>
<h2 id="data-abstraction">Data Abstraction</h2>
<p>Data abstraction is similar in character to functional abstraction. When we create a functional abstraction, the details of how a function is implemented can be suppressed, and the particular function itself can be replaced by any other function with the same overall behavior. In other words, we can make an abstraction that separates the way the function is used from the details of how the function is implemented. Analogously, data abstraction isolates how a compound data value is used from the details of how it is constructed.</p>
<p>数据抽象和函数抽象是相似的。咱不需要管这个数据是如何组织的，只需要知道如何去用这个数据。</p>
<h3 id="sequences">Sequences</h3>
<p>具有这两个行为的数据称为sequences：</p>
<ul>
<li>finite length.</li>
<li>可以通过索引（从0开始的）来选择元素</li>
</ul>
<p>Extend behaviours</p>
<ol type="1">
<li><strong>Membership</strong>.Python has two operators <code>in</code>and <code>not in</code> that evaluate to <code>True</code> or <code>False</code> depending on whether an element appears in a sequence.</li>
<li><strong>Slicing.（切片）</strong></li>
</ol>
<h4 id="lists">Lists</h4>
<p>A <code>list</code> value is a sequence that can have arbitrary length.</p>
<p>list的操作</p>
<ul>
<li>add：两个list相加，将两个list扩展成一个大的list，就是拼接两个list</li>
<li>mul：一个list乘上一个常数，就是复制多少次这个list</li>
</ul>
<p><strong>List Comprehensions.(列表生成式)</strong> Many sequence processing operations can be expressed by evaluating a fixed expression for each element in a sequence and collecting the resulting values in a result sequence. In Python, a list comprehension is an expression that performs such a computation.</p>
<p>The general form of a list comprehension is:</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="xml"><span class="tag">&lt;<span class="name">map</span> <span class="attr">expression</span>&gt;</span></span> for <span class="xml"><span class="tag">&lt;<span class="name">name</span>&gt;</span></span> in <span class="xml"><span class="tag">&lt;<span class="name">sequence</span> <span class="attr">expression</span>&gt;</span></span> if <span class="xml"><span class="tag">&lt;<span class="name">filter</span> <span class="attr">expression</span>&gt;</span></span>]</span><br></pre></td></tr></table></figure>
<h4 id="ranges">Ranges</h4>
<p>A <code>range</code> is another built-in type of sequence in Python, which represents a range of integers.</p>
<p>Ranges commonly appear as the expression in a <code>for</code> header to specify the number of times that the suite should be executed: A common convention is to use a single underscore character for the name in the <code>for</code> header if the name is unused in the suite.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    print(<span class="string">&#x27;Go Bears!&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h4 id="strings">Strings</h4>
<p>Strings satisfy the two basic conditions of a sequence that we introduced at the beginning of this section: they have a length and they support element selection.</p>
<p><strong>Note</strong>: Unlike many other programming languages, Python does not have a separate character type; <strong>any text is a string, and strings that represent single characters have a length of 1.</strong></p>
<p><strong>Membership.</strong> The behavior of strings diverges from other sequence types in Python. <strong>It matches substrings rather than elements.</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;here&#x27;</span> <span class="keyword">in</span> <span class="string">&quot;Where&#x27;s Waldo?&quot;</span></span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>
<p><strong>Multiline Literals.</strong> Strings aren't limited to a single line. Triple quotes delimit string literals that span multiple lines.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&quot;&quot;&quot;The Zen of Python</span></span><br><span class="line"><span class="string">claims, Readability counts.</span></span><br><span class="line"><span class="string">Read more: import this.&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&#x27;The Zen of Python\nclaims, &quot;Readability counts.&quot;\nRead more: import this.&#x27;</span></span><br></pre></td></tr></table></figure>
<p><strong>String Coercion.</strong> A string can be created from any object in Python by calling the <code>str</code> constructor function with an object value as its argument.</p>
<h4 id="nesting-lists-使用原生的sequeece构造复杂的数据结构">Nesting lists （使用原生的sequeece构造复杂的数据结构）</h4>
<h5 id="tree">Tree</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>t = tree(<span class="number">3</span>, [tree(<span class="number">1</span>), tree(<span class="number">2</span>, [tree(<span class="number">1</span>), tree(<span class="number">1</span>)])])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t</span><br><span class="line">[<span class="number">3</span>, [<span class="number">1</span>], [<span class="number">2</span>, [<span class="number">1</span>], [<span class="number">1</span>]]]</span><br></pre></td></tr></table></figure>
<p>第一个list节点为root节点，然后之后两个list为左右子树</p>
<h5 id="linked-list-链表">Linked list 链表</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">four = [<span class="number">1</span>, [<span class="number">2</span>, [<span class="number">3</span>, [<span class="number">4</span>, <span class="string">&#x27;empty&#x27;</span>]]]]</span><br></pre></td></tr></table></figure>
<figure>
<img src="http://image-bed.limit-infinite.top/images/blog/082935.png" alt="image-20230129114046273" /><figcaption aria-hidden="true">image-20230129114046273</figcaption>
</figure>
<h3 id="sequence-iteration">Sequence Iteration</h3>
<p><strong>Sequence unpacking</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pairs = [[<span class="number">1</span>, <span class="number">2</span>], [<span class="number">2</span>, <span class="number">2</span>], [<span class="number">2</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">4</span>]]</span><br><span class="line">same_count = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> x, y <span class="keyword">in</span> pairs:</span><br><span class="line">    <span class="keyword">if</span> x == y:</span><br><span class="line">        same_count = same_count + <span class="number">1</span></span><br><span class="line">print(same_count)</span><br></pre></td></tr></table></figure>
<p>This pattern of binding multiple names to multiple values in a fixed-length sequence is called <em>sequence unpacking</em>; it is the same pattern that we see in assignment statements that bind multiple names to multiple values.</p>
<h2 id="mutable-data">Mutable Data</h2>
<p>In fact, all values in Python are objects. That is, all values have behavior and attributes. They act like the values they represent.</p>
<p><strong>List comprehensions.</strong> A list comprehension always creates a new list.</p>
<p><strong>Tuples.</strong> A tuple, an instance of the built-in <code>tuple</code> type, is an <strong>immutable</strong> sequence.</p>
<p>Dictionaries do have some restrictions:</p>
<ul>
<li>A key of a dictionary cannot be or contain a mutable value.</li>
<li>There can be at most one value for a given key.</li>
</ul>
<h3 id="nonlocal"><code>nonlocal</code></h3>
<p>The <code>nonlocal</code> statement declares that whenever we change the binding of the name <code>balance</code>, the binding is changed in the first frame in which <code>balance</code> is already bound. (常用于内部函数)</p>
<p>The key to correctly analyzing code with nonlocal assignment is to remember that only function calls can introduce new frames. Assignment statements always change bindings in existing frames.</p>
<h2 id="implict-sequences">Implict Sequences</h2>
<p>A sequence can be represented without each element being stored explicitly in the memory of the computer.</p>
<p>Computing values on demand, rather than retrieving them from an existing representation, is an example of <em>lazy</em> computation.</p>
<p><code>range</code> is a example for Implict sequences.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>r = <span class="built_in">range</span>(<span class="number">10000</span>, <span class="number">1000000000</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r[<span class="number">45006230</span>]</span><br><span class="line"><span class="number">45016230</span></span><br></pre></td></tr></table></figure>
<h3 id="iterator">Iterator</h3>
<p>Calling <code>iter</code> on an iterator will return that iterator, not a copy.</p>
<h3 id="iterable">Iterable</h3>
<p>Any value that can produce iterators is called an <em>iterable</em> value. In Python, an iterable value is anything that can be passed to the built-in <code>iter</code> function.</p>
<p>Iterators are also iterables, because they can be passed to the <code>iter</code> function.</p>
<h3 id="built-in-iterator">Built-in Iterator</h3>
<p>Several built-in functions take as arguments iterable values and return iterators. These functions are used extensively for lazy sequence processing.</p>
<p>Such as <code>map</code>,<code>filter</code>,<code>zip</code>,<code>reversed</code>,etc.</p>
<h3 id="for-statements">For Statements</h3>
<p>Objects are <em>iterable</em> (an interface) if they have an <code>__iter__</code> method that returns an <em>iterator</em>.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>counts = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> item <span class="keyword">in</span> counts:</span><br><span class="line">        print(item)</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>items = counts.__iter__()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            item = items.__next__()</span><br><span class="line">            print(item)</span><br><span class="line">    <span class="keyword">except</span> StopIteration:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure>
<h3 id="generators-and-yield-statements">Generators and Yield Statements</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">letters_generator</span>():</span></span><br><span class="line">        current = <span class="string">&#x27;a&#x27;</span></span><br><span class="line">        <span class="keyword">while</span> current &lt;= <span class="string">&#x27;d&#x27;</span>:</span><br><span class="line">            <span class="keyword">yield</span> current</span><br><span class="line">            current = <span class="built_in">chr</span>(<span class="built_in">ord</span>(current)+<span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> letter <span class="keyword">in</span> letters_generator():</span><br><span class="line">        print(letter)</span><br><span class="line">a</span><br><span class="line">b</span><br><span class="line">c</span><br><span class="line">d</span><br></pre></td></tr></table></figure>
<p>Even though we never explicitly defined <code>__iter__</code> or <code>__next__</code> methods, the <code>yield</code> statement indicates that we are defining a generator function. When called, a generator function doesn't return a particular yielded value, but instead a <code>generator</code> (which is a type of iterator) that itself can return the yielded values.</p>
<p>A generator object has <code>__iter__</code> and <code>__next__</code> methods</p>
<h3 id="iterable-interface"><strong>Iterable</strong> Interface</h3>
<p>An object is iterable if it returns an iterator when its <code>__iter__</code> method is invoked. Iterable values represent data collections, and they provide a fixed representation that may produce more than one iterator.</p>
<h3 id="iterator-interface"><strong>Iterator</strong> Interface</h3>
<p>The Python iterator interface is defined using a method called <code>__next__</code> that returns the next element of some underlying sequential series that it represents. In response to invoking <code>__next__</code>, an iterator can perform arbitrary computation in order to either retrieve or compute the next element.</p>
<p>built-in <code>iter</code> function is called on the iterable to create a corresponding <em>iterator</em>.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">iterator = <span class="built_in">iter</span>(iterable)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        elem = <span class="built_in">next</span>(iterator)</span><br><span class="line">        <span class="comment"># do something</span></span><br><span class="line"><span class="keyword">except</span> StopIteration:</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<h2 id="object-oriented-programming">Object-Oriented Programming</h2>
<p>简单的说明 对象是个啥</p>
<p>an object is a data value that has methods and attributes, accessible via dot notation. Every object also has a type, called its <em>class</em>. To create new types of data, we implement new classes.</p>
<h3 id="objects-and-classes">Objects and Classes</h3>
<p>object和class之间的关系</p>
<p>A class serves as a template for all objects whose type is that class. Every object is an instance of some particular class.</p>
<p><code>notes: 类名也可以作为参数传递给函数或者方法中</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ant</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,mass</span>):</span></span><br><span class="line">        self.mass = mass</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SmallAnt</span>(<span class="params">Ant</span>):</span></span><br><span class="line">    strength = <span class="number">1</span> <span class="comment"># 体力</span></span><br><span class="line">    speed = <span class="number">10</span> <span class="comment"># 移速</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BigAnt</span>(<span class="params">Ant</span>):</span></span><br><span class="line">    strength = <span class="number">10</span> <span class="comment"># 体力</span></span><br><span class="line">    speed = <span class="number">1</span> <span class="comment"># 移速 </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_ant</span>(<span class="params">kind,mass</span>):</span></span><br><span class="line">  	new_ant = kind(mass)</span><br><span class="line">    <span class="keyword">return</span> new_ant</span><br><span class="line"><span class="comment"># test</span></span><br><span class="line">my_ant = make_ant(BigAnt,<span class="number">20</span>)</span><br><span class="line"><span class="built_in">type</span>(my_ant)</span><br></pre></td></tr></table></figure>
<p>跟<code>__call__</code>有点像，但是这个是将<code>class</code>当作函数在使用，而后者是将<code>class</code>的对象or实例当作函数在使用。</p>
<h3 id="defining-classes">Defining Classes</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> &lt;<span class="title">name</span>&gt;:</span></span><br><span class="line">  &lt;suit&gt;</span><br></pre></td></tr></table></figure>
<p>上述statement就会创建一个名为name的class</p>
<p><code>__init__</code>函数是the <em>constructor</em> for the class</p>
<figure>
<img src="http://image-bed.limit-infinite.top/images/blog/2023-01-30-032316.png" alt="image-20230130112312832" /><figcaption aria-hidden="true">image-20230130112312832</figcaption>
</figure>
<p>The <code>__init__</code> method for <code>Account</code> has two formal parameters. The first one, <code>self</code>, is bound to the newly created <code>Account</code> object. The second parameter, <code>account_holder</code>, is bound to the argument passed to the class when it is called to be instantiated.</p>
<p>By convention, we use the parameter name <code>self</code> for the first argument of a <strong>constructor</strong>, because it is bound to the object being instantiated. This convention is adopted in virtually all Python code.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = Account(<span class="string">&#x27;Kirk&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>调用class，创建了一个新对象</p>
<p>如何判断两个对象是否为同一个对象，可以用<code>is</code>和<code>is not</code>操作符。</p>
<p>Object identity is compared using the <code>is</code> and <code>is not</code> operators.</p>
<p><strong>Methods.</strong> Each method definition again includes a special first parameter <code>self</code>, which is bound to the object on which the method is invoked.</p>
<figure>
<img src="http://image-bed.limit-infinite.top/images/blog/2023-01-30-034048.png" alt="image-20230130114046713" /><figcaption aria-hidden="true">image-20230130114046713</figcaption>
</figure>
<p>当通过调用class里的函数时，比如</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>myaccount = Account(<span class="string">&#x27;yj&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>myaccount.deposit(<span class="number">100</span>)</span><br></pre></td></tr></table></figure>
<p><code>myaccount</code>调用了deposit，此时myaccount赋予了deposit意义，deposit将myaccount这个对象里的钱存了xx。myaccount又作为参数，传递给deposit中的<code>self</code></p>
<h3 id="message-passing-and-dot-expressions">Message Passing and Dot Expressions</h3>
<p><strong>Dot expressions.</strong> The code fragment <code>myaccount.deposit</code> is called a <em>dot expression</em>. A dot expression consists of an expression, a dot, and a name:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;expression&gt; . &lt;name&gt;</span><br></pre></td></tr></table></figure>
<p>The built-in function <code>getattr</code> also returns an attribute for an object by name. It is the function equivalent of dot notation.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">getattr</span>(myaccount, <span class="string">&#x27;balance&#x27;</span>)</span><br><span class="line"><span class="number">10</span></span><br></pre></td></tr></table></figure>
<p>We can also test whether an object has a named attribute with <code>hasattr</code>.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hasattr</span>(myaccount, <span class="string">&#x27;deposit&#x27;</span>)</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>
<p>看来对象中的方法也是一个attribute</p>
<p><strong>Methods and functions.</strong> When a method is invoked on an object, that object is implicitly passed as the first argument to the method.</p>
<p>object里定义的函数与普通的函数不一样。用<code>type</code>看看这两种函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">type</span>(Account.deposit)</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">function</span>&#x27;&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">type</span>(<span class="params">myaccount.deposit</span>)</span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> &#x27;<span class="title">method</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure>
<p>As an attribute of a class, a method is just a <code>function</code>, but as an attribute of an instance, it is a <code>bound method</code>.</p>
<p>bound method的一些解释</p>
<p><em>bound methods</em>, which couple together a function and the object on which that method will be invoked. A bound method value is already associated with its first argument, the instance on which it was invoked, which will be named <code>self</code> when the method is called.</p>
<p>再来看下上面给的例子，<code>type(Account.deposit)</code>这个函数，需要你提供两个参数——<code>self</code>和<code>amount</code>，它就是一个普通的函数。而下面<code>myaccount.deposit</code>这个方法，只需要你提供<code>amount</code>这个参数，其中<code>self</code>这个参数，自动绑定<code>myaccount</code>对象。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Account.deposit(myaccount, <span class="number">1001</span>)</span><br><span class="line"><span class="number">1011</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>myaccount.deposit(<span class="number">1000</span>)         </span><br><span class="line"><span class="number">2011</span></span><br></pre></td></tr></table></figure>
<p>The function <code>getattr</code> behaves exactly like dot notation: if its first argument is an object but the name is a method defined in the class, then <code>getattr</code> returns a <strong>bound method</strong> value. On the other hand, if the first argument is a class, then <code>getattr</code> returns the attribute value directly, which is a plain <strong>function</strong>.</p>
<p><strong>Naming Conventions.</strong> Class names are conventionally written using the CapWords convention (also called CamelCase because the capital letters in the middle of a name look like humps). Method names follow the standard convention of naming functions using lowercased words separated by underscores. （类名用骆驼峰式命名，方法用小写字母和下划线命名）</p>
<p>其他规定：如果一个attribute的名字以下划线开头，则这个attribute只能在类里面访问，不能在外部访问使用。</p>
<h3 id="class-attributes">Class Attributes</h3>
<p>Some attribute values are shared across all objects of a given class. Such attributes are associated with the class itself, rather than any individual instance of the class.</p>
<p>In the broader developer community, class attributes may also be called class variables or static variables. (类变量，静态变量)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Account</span>:</span></span><br><span class="line">        interest = <span class="number">0.02</span>            <span class="comment"># A class attribute</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, account_holder</span>):</span></span><br><span class="line">            self.balance = <span class="number">0</span></span><br><span class="line">            self.holder = account_holder</span><br><span class="line">        <span class="comment"># Additional methods would be defined here</span></span><br></pre></td></tr></table></figure>
<p>This attribute can still be accessed from any instance of the class.</p>
<p>However, a single assignment statement to a class attribute changes the value of the attribute for all instances of the class.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Account.interest = <span class="number">0.04</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>spock_account.interest</span><br><span class="line"><span class="number">0.04</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>kirk_account.interest</span><br><span class="line"><span class="number">0.04</span></span><br></pre></td></tr></table></figure>
<p><strong>Attribute names.</strong> we could easily have a class attribute and an instance attribute with the same name. 类中静态变量的名字可以和实例中的变量的名字相同，但访问的优先级不同，实例中变量优先级更高，即先从局部变量找，再到全局变量找。</p>
<p>As we have seen, a dot expression consists of an expression, a dot, and a name:</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;expression&gt; . &lt;name&gt;</span><br></pre></td></tr></table></figure>
<p>To evaluate a dot expression:</p>
<ol type="1">
<li>Evaluate the <code>&lt;expression&gt;</code> to the left of the dot, which yields the <em>object</em> of the dot expression.</li>
<li><code>&lt;name&gt;</code> is matched against the instance attributes of that object; if an attribute with that name exists, its value is returned.</li>
<li>If <code>&lt;name&gt;</code> does not appear among instance attributes, then <code>&lt;name&gt;</code> is looked up in the class, which yields a class attribute value.</li>
<li>That value is returned unless it is a function, in which case a bound method is returned instead.</li>
</ol>
<p><strong>Attribute assignment.</strong> If the object is an <strong>instance</strong>, then assignment sets an <strong>instance attribute</strong>. If the object is a <strong>class</strong>, then assignment sets a <strong>class attribute</strong>. As a consequence of this rule, assignment to an attribute of an object cannot affect the attributes of its class. 当类的实例为类属性赋值时，实例中会创建一个新的属性（和类属性同名）</p>
<p>If we assign to the named attribute <code>interest</code> of an account instance, we create a new instance attribute that has the same name as the existing class attribute.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>kirk_account.interest = <span class="number">0.08</span></span><br></pre></td></tr></table></figure>
<p>and that attribute value will be returned from a dot expression.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>kirk_account.interest</span><br><span class="line"><span class="number">0.08</span></span><br></pre></td></tr></table></figure>
<p>However, the class attribute <code>interest</code> still retains its original value, which is returned for all other accounts.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>spock_account.interest</span><br><span class="line"><span class="number">0.04</span></span><br></pre></td></tr></table></figure>
<p>Changes to the class attribute <code>interest</code> will affect <code>spock_account</code>, but the instance attribute for <code>kirk_account</code> will be unaffected.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Account.interest = <span class="number">0.05</span>  <span class="comment"># changing the class attribute</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>spock_account.interest     <span class="comment"># changes instances without like-named instance attributes</span></span><br><span class="line"><span class="number">0.05</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>kirk_account.interest     <span class="comment"># but the existing instance attribute is unaffected</span></span><br><span class="line"><span class="number">0.08</span></span><br></pre></td></tr></table></figure>
<h3 id="inheritance">Inheritance</h3>
<p>简单的说明继承是啥</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ch = CheckingAccount(<span class="string">&#x27;Spock&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ch.interest     <span class="comment"># Lower interest rate for checking accounts</span></span><br><span class="line"><span class="number">0.01</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ch.deposit(<span class="number">20</span>)  <span class="comment"># Deposits are the same</span></span><br><span class="line"><span class="number">20</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ch.withdraw(<span class="number">5</span>)  <span class="comment"># withdrawals decrease balance by an extra charge</span></span><br><span class="line"><span class="number">14</span></span><br></pre></td></tr></table></figure>
<p>A <code>CheckingAccount</code> is a specialization of an <code>Account</code>. In OOP terminology, the generic account will serve as the base class of <code>CheckingAccount</code>, while <code>CheckingAccount</code> will be a subclass of <code>Account</code>.</p>
<p>A subclass <em>inherits</em> the attributes of its base class, but may <em>override</em> certain attributes, including certain methods. With inheritance, we only specify what is different between the subclass and the base class. Anything that we leave unspecified in the subclass is automatically assumed to behave just as it would for the base class.</p>
<p>给个例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Account</span>:</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;A bank account that has a non-negative balance.&quot;&quot;&quot;</span></span><br><span class="line">        interest = <span class="number">0.02</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, account_holder</span>):</span></span><br><span class="line">            self.balance = <span class="number">0</span></span><br><span class="line">            self.holder = account_holder</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">deposit</span>(<span class="params">self, amount</span>):</span></span><br><span class="line">            <span class="string">&quot;&quot;&quot;Increase the account balance by amount and return the new balance.&quot;&quot;&quot;</span></span><br><span class="line">            self.balance = self.balance + amount</span><br><span class="line">            <span class="keyword">return</span> self.balance</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">withdraw</span>(<span class="params">self, amount</span>):</span></span><br><span class="line">            <span class="string">&quot;&quot;&quot;Decrease the account balance by amount and return the new balance.&quot;&quot;&quot;</span></span><br><span class="line">            <span class="keyword">if</span> amount &gt; self.balance:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;Insufficient funds&#x27;</span></span><br><span class="line">            self.balance = self.balance - amount</span><br><span class="line">            <span class="keyword">return</span> self.balance</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">CheckingAccount</span>(<span class="params">Account</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;A bank account that charges for withdrawals.&quot;&quot;&quot;</span></span><br><span class="line">        withdraw_charge = <span class="number">1</span></span><br><span class="line">        interest = <span class="number">0.01</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">withdraw</span>(<span class="params">self, amount</span>):</span></span><br><span class="line">            <span class="keyword">return</span> Account.withdraw(self, amount + self.withdraw_charge)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>checking = CheckingAccount(<span class="string">&#x27;Sam&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>checking.deposit(<span class="number">10</span>)</span><br><span class="line"><span class="number">10</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>checking.withdraw(<span class="number">5</span>)</span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>checking.interest</span><br><span class="line"><span class="number">0.01</span></span><br></pre></td></tr></table></figure>
<p>We can define this procedure recursively. To look up a name in a class.</p>
<ol type="1">
<li>If it names an attribute in the class, return the attribute value.</li>
<li>Otherwise, look up the name in the base class, if there is one.</li>
</ol>
<p>Note: The class of an object stays constant throughout. Even though the <code>deposit</code> method was found in the <code>Account</code> class, <code>deposit</code> is called with <code>self</code> bound to an instance of <code>CheckingAccount</code>, not of <code>Account</code>.</p>
<p><strong>Calling ancestors.</strong> Attributes that have been overridden are still accessible via class objects. For instance, we implemented the <code>withdraw</code> method of <code>CheckingAccount</code> by calling the <code>withdraw</code> method of <code>Account</code> with an argument that included the <code>withdraw_charge</code>.</p>
<p>Notice that we called <code>self.withdraw_charge</code> rather than the equivalent<code>CheckingAccount.withdraw_charge</code>. The benefit of the former over the latter is that a class that inherits from <code>CheckingAccount</code> might override the withdrawal charge. If that is the case, we would like our implementation of <code>withdraw</code> to find that new value instead of the old one.(就是用<code>self</code>可以保持更新，如果修改了类静态变量)</p>
<p><strong>Interfaces.</strong> It is extremely common in object-oriented programs that different types of objects will share the same attribute names. An <em>object interface</em> is a collection of attributes and conditions on those attributes.</p>
<p>In some programming languages such as Java, interface implementations must be explicitly declared. In others such as Python, Ruby, and Go, any object with the appropriate names implements an interface.</p>
<p>例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">deposit_all</span>(<span class="params">winners, amount=<span class="number">5</span></span>):</span></span><br><span class="line">        <span class="keyword">for</span> account <span class="keyword">in</span> winners:</span><br><span class="line">            account.deposit(amount)</span><br></pre></td></tr></table></figure>
<p>例子中的<code>account</code>必须是要有<code>Account.deposit</code>的实现的任何类</p>
<h3 id="multiple-inheritance">Multiple Inheritance</h3>
<p>Python supports the concept of a subclass inheriting attributes from multiple base classes, a language feature called <em>multiple inheritance</em>.</p>
<p>例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">SavingsAccount</span>(<span class="params">Account</span>):</span></span><br><span class="line">        deposit_charge = <span class="number">2</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">deposit</span>(<span class="params">self, amount</span>):</span></span><br><span class="line">            <span class="keyword">return</span> Account.deposit(self, amount - self.deposit_charge)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">AsSeenOnTVAccount</span>(<span class="params">CheckingAccount, SavingsAccount</span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, account_holder</span>):</span></span><br><span class="line">            self.holder = account_holder</span><br><span class="line">            self.balance = <span class="number">1</span>           <span class="comment"># A free dollar!</span></span><br></pre></td></tr></table></figure>
<p><code>AsSeenOnTVAccount</code>同时继承了两个类。</p>
<p><img src="http://image-bed.limit-infinite.top/images/blog/2023-02-02-075908.png" alt="img" style="zoom:150%;" /></p>
<p>当<code>AsSeenOnTVAccount</code>的实例调用一个属性的时，若所有的base class都有该属性并重写了，该如何选择.</p>
<p>python 遵循：如上图，先从左到右，在从下往上。</p>
<p>所以顺序是：AsSeenOnTVAccount, CheckingAccount, SavingsAccount, Account, object</p>
<p><strong>Further reading.</strong> Python resolves this name using a recursive algorithm called the C3 Method Resolution Ordering. The method resolution order of any class can be queried using the <code>mro</code> method on all classes.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>[c.__name__ <span class="keyword">for</span> c <span class="keyword">in</span> AsSeenOnTVAccount.mro()]</span><br><span class="line">[<span class="string">&#x27;AsSeenOnTVAccount&#x27;</span>, <span class="string">&#x27;CheckingAccount&#x27;</span>, <span class="string">&#x27;SavingsAccount&#x27;</span>, <span class="string">&#x27;Account&#x27;</span>, <span class="string">&#x27;object&#x27;</span>]</span><br></pre></td></tr></table></figure>
<h2 id="object-abstraction">Object Abstraction</h2>
<p>A central concept in object abstraction is a <em>generic function</em>(泛型函数), which is a function that can accept values of multiple different types.We will consider three different techniques for implementing generic functions: shared interfaces, type dispatching, and type coercion.</p>
<h3 id="string-conversion">String Conversion</h3>
<p>String values provide a fundamental medium for communicating information among humans.</p>
<p>python规定所有的objects都要有两个string representations：</p>
<ol type="1">
<li><code>str</code>，得到一个human-readable string；当<code>print(any objects)</code>时调用<code>str</code></li>
<li><code>repr</code>，得到一个 Python expression，并且<code>eval(repr(object)) == object</code>；当在python 终端中直接输入objects时，调用<code>repr</code></li>
</ol>
<p>这两个虽然都返回一个字符串，但是还有有区别的。</p>
<p>举个例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> datetime <span class="keyword">import</span> date</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tues = date(<span class="number">2011</span>, <span class="number">9</span>, <span class="number">12</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">repr</span>(tues)</span><br><span class="line"><span class="string">&#x27;datetime.date(2011, 9, 12)&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">str</span>(tues)</span><br><span class="line"><span class="string">&#x27;2011-09-12&#x27;</span></span><br></pre></td></tr></table></figure>
<p>想要能够对所有的对象都能调用<code>repr</code>或者<code>str</code>就需要将其变为<em>generic function</em></p>
<p>The object system provides an elegant solution in this case: the <code>repr</code> function always invokes a method called <code>__repr__</code> on its argument.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>tues.__repr__()</span><br><span class="line"><span class="string">&#x27;datetime.date(2011, 9, 12)&#x27;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>tues.__str__()</span><br><span class="line"><span class="string">&#x27;2011-09-12&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="special-methods">Special Methods</h3>
<p>In Python, certain <em>special names</em> are invoked by the Python interpreter in special circumstances.</p>
<p><strong>True and false values.</strong> We saw previously that numbers in Python have a truth value; more specifically, 0 is a false value and all other numbers are true values. In fact, all objects in Python have a truth value.但是你自己定义的class可以通过重写<code>__bool__</code>方法来改变。</p>
<p>举个例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Account.__bool__ = <span class="keyword">lambda</span> self: self.balance != <span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">bool</span>(Account(<span class="string">&#x27;Jack&#x27;</span>))</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">if</span> <span class="keyword">not</span> Account(<span class="string">&#x27;Jack&#x27;</span>):</span><br><span class="line">        print(<span class="string">&#x27;Jack has nothing&#x27;</span>)</span><br><span class="line">Jack has nothing</span><br></pre></td></tr></table></figure>
<p>之前定义的<code>Account</code>类，改写其bool值，当账户余额为0时，为<code>False</code>。</p>
<p><strong>Sequence operations.</strong> We have seen that we can call the <code>len</code> function to determine the length of a sequence.</p>
<p>The <code>len</code> function invokes the <code>__len__</code> method of its argument to determine its length. All built-in sequence types implement this method.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;Go Bears!&#x27;</span>.__len__()</span><br><span class="line"><span class="number">9</span></span><br></pre></td></tr></table></figure>
<p>Python uses a sequence's length to determine its truth value, if it does not provide a <code>__bool__</code>method. Empty sequences are false, while non-empty sequences are true.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">bool</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">bool</span>([])</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">bool</span>(<span class="string">&#x27;Go Bears!&#x27;</span>)</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>
<p>The <code>__getitem__</code> method is invoked by the element selection operator, but it can also be invoked directly.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; &#39;Go Bears!&#39;[3]</span><br><span class="line">&#39;B&#39;</span><br><span class="line">&gt;&gt;&gt; &#39;Go Bears!&#39;.__getitem__(3)</span><br><span class="line">&#39;B&#39;</span><br></pre></td></tr></table></figure>
<p><strong>Callable objects.</strong> In Python, functions are first-class objects, so they can be passed around as data and have attributes like any other object. Python also allows us to define objects that can be "called" like functions by including a <code>__call__</code> method. With this method, we can define a class that behaves like a higher-order function.</p>
<p>举个例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">make_adder</span>(<span class="params">n</span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">adder</span>(<span class="params">k</span>):</span></span><br><span class="line">            <span class="keyword">return</span> n + k</span><br><span class="line">        <span class="keyword">return</span> adder</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>add_three = make_adder(<span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>add_three(<span class="number">4</span>)</span><br><span class="line"><span class="number">7</span></span><br></pre></td></tr></table></figure>
<p>上面是一个高阶函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Adder</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, n</span>):</span></span><br><span class="line">            self.n = n</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__call__</span>(<span class="params">self, k</span>):</span></span><br><span class="line">            <span class="keyword">return</span> self.n + k</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>add_three_obj = Adder(<span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>add_three_obj(<span class="number">4</span>)</span><br><span class="line"><span class="number">7</span></span><br></pre></td></tr></table></figure>
<p>这个<code>Adder</code>类的功能和上述的高阶函数的功能一致</p>
<p>Here, the <code>Adder</code> class behaves like the <code>make_adder</code> higher-order function, and the <code>add_three_obj</code>object behaves like the <code>add_three</code> function.</p>
<h3 id="multiple-representations">Multiple Representations</h3>
<p>Abstraction barriers allow us to separate the use and representation of data. However, in large programs, it may not always make sense to speak of "the underlying representation" for a data type in a program. For one thing, there might be <strong>more than one</strong> useful representation for a data object, and we might like to design systems that can deal with multiple representations.</p>
<p>举个例子：</p>
<p>复数，可以用直角坐标系进行表示，分为实部和虚部；也可以用极坐标进行表示，分为长度和角度；详细情况请参考<a target="_blank" rel="noopener" href="https://mengqi92.github.io/2015/10/06/complex/">这篇文章</a>。</p>
<p>从0开始实现一个复数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Number</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__add__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">      			<span class="string">&#x27;&#x27;&#x27;special method 加法</span></span><br><span class="line"><span class="string">      			&#x27;&#x27;&#x27;</span></span><br><span class="line">            <span class="keyword">return</span> self.add(other)</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__mul__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">          	<span class="string">&#x27;&#x27;&#x27;special method 乘法</span></span><br><span class="line"><span class="string">          	&#x27;&#x27;&#x27;</span></span><br><span class="line">            <span class="keyword">return</span> self.mul(other)</span><br></pre></td></tr></table></figure>
<p>这是一个superclass，所有的数都继承与它。（类似于Java中的interface）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Complex</span>(<span class="params">Number</span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">self, other</span>):</span></span><br><span class="line">      			<span class="string">&#x27;&#x27;&#x27;用直角坐标系的表示，进行加法</span></span><br><span class="line"><span class="string">      			&#x27;&#x27;&#x27;</span></span><br><span class="line">            <span class="keyword">return</span> ComplexRI(self.real + other.real, self.imag + other.imag)</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">mul</span>(<span class="params">self, other</span>):</span></span><br><span class="line">          	<span class="string">&#x27;&#x27;&#x27;用极坐标系的表示，进行乘法</span></span><br><span class="line"><span class="string">          	&#x27;&#x27;&#x27;</span></span><br><span class="line">            magnitude = self.magnitude * other.magnitude</span><br><span class="line">            <span class="keyword">return</span> ComplexMA(magnitude, self.angle + other.angle)</span><br></pre></td></tr></table></figure>
<p>下面分别是<code>ComplexRI</code>和<code>ComplexMA</code>的实现</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> math <span class="keyword">import</span> atan2</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">ComplexRI</span>(<span class="params">Complex</span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, real, imag</span>):</span></span><br><span class="line">            self.real = real</span><br><span class="line">            self.imag = imag</span><br><span class="line"><span class="meta">        @property</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">magnitude</span>(<span class="params">self</span>):</span></span><br><span class="line">            <span class="keyword">return</span> (self.real ** <span class="number">2</span> + self.imag ** <span class="number">2</span>) ** <span class="number">0.5</span></span><br><span class="line"><span class="meta">        @property</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">angle</span>(<span class="params">self</span>):</span></span><br><span class="line">            <span class="keyword">return</span> atan2(self.imag, self.real)</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span>(<span class="params">self</span>):</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;ComplexRI(&#123;0:g&#125;, &#123;1:g&#125;)&#x27;</span>.<span class="built_in">format</span>(self.real, self.imag)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> math <span class="keyword">import</span> sin, cos, pi</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">ComplexMA</span>(<span class="params">Complex</span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, magnitude, angle</span>):</span></span><br><span class="line">            self.magnitude = magnitude</span><br><span class="line">            self.angle = angle</span><br><span class="line"><span class="meta">        @property</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">real</span>(<span class="params">self</span>):</span></span><br><span class="line">            <span class="keyword">return</span> self.magnitude * cos(self.angle)</span><br><span class="line"><span class="meta">        @property</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">imag</span>(<span class="params">self</span>):</span></span><br><span class="line">            <span class="keyword">return</span> self.magnitude * sin(self.angle)</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span>(<span class="params">self</span>):</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;ComplexMA(&#123;0:g&#125;, &#123;1:g&#125; * pi)&#x27;</span>.<span class="built_in">format</span>(self.magnitude, self.angle/pi)</span><br></pre></td></tr></table></figure>
<p>其中，The <code>@property</code> decorator allows functions to be called without call expression syntax (parentheses following an expression).</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ri = ComplexRI(<span class="number">5</span>, <span class="number">12</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ri.real</span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ri.magnitude</span><br><span class="line"><span class="number">13.0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ri.real = <span class="number">9</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ri.real</span><br><span class="line"><span class="number">9</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ri.magnitude</span><br><span class="line"><span class="number">15.0</span></span><br></pre></td></tr></table></figure>
<p>最后进行一个测试：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> math <span class="keyword">import</span> pi</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ComplexRI(<span class="number">1</span>, <span class="number">2</span>) + ComplexMA(<span class="number">2</span>, pi/<span class="number">2</span>)</span><br><span class="line">ComplexRI(<span class="number">1</span>, <span class="number">4</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ComplexRI(<span class="number">0</span>, <span class="number">1</span>) * ComplexRI(<span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">ComplexMA(<span class="number">1</span>, <span class="number">1</span> * pi)</span><br></pre></td></tr></table></figure>
<p><strong>Interfaces.</strong> Object attributes, which are a form of message passing, allows different data types to respond to the same message in different ways. A shared set of messages that elicit similar behavior from different classes is a powerful method of abstraction. An <em>interface</em> is a set of shared attribute names, along with a specification of their behavior. In the case of complex numbers, the interface needed to implement arithmetic consists of four attributes: <code>real</code>, <code>imag</code>, <code>magnitude</code>, and <code>angle</code>.</p>
<p>The interface approach to encoding multiple representations has appealing properties.</p>
<p>Multiple representations of data are closely related to the idea of data abstraction with which we began this chapter. Using data abstraction, we were able to change the implementation of a data type without changing the meaning of the program. With interfaces and message passing, we can have multiple different representations within the same program. In both cases, a set of names and corresponding behavior conditions define the abstraction that enables this flexibility.</p>
<h3 id="generic-functions">Generic Functions</h3>
<p>Generic functions are methods or functions that apply to arguments of different types.</p>
<p>但是两个不同类型的对象（虽然他们继承与同一个父类）如何进行交互，比如复数和分数直接如何加和乘。</p>
<p>本文中给出了两种方式：</p>
<ol type="1">
<li>type dispatching 类型调度</li>
<li>coercion 类型强制转换</li>
</ol>
<p>先给出实现分数的代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> fractions <span class="keyword">import</span> gcd</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Rational</span>(<span class="params">Number</span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, numer, denom</span>):</span></span><br><span class="line">            g = gcd(numer, denom)</span><br><span class="line">            self.numer = numer // g</span><br><span class="line">            self.denom = denom // g</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span>(<span class="params">self</span>):</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;Rational(&#123;0&#125;, &#123;1&#125;)&#x27;</span>.<span class="built_in">format</span>(self.numer, self.denom)</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">self, other</span>):</span></span><br><span class="line">            nx, dx = self.numer, self.denom</span><br><span class="line">            ny, dy = other.numer, other.denom</span><br><span class="line">            <span class="keyword">return</span> Rational(nx * dy + ny * dx, dx * dy)</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">mul</span>(<span class="params">self, other</span>):</span></span><br><span class="line">            numer = self.numer * other.numer</span><br><span class="line">            denom = self.denom * other.denom</span><br><span class="line">            <span class="keyword">return</span> Rational(numer, denom)</span><br></pre></td></tr></table></figure>
<p><strong>Type dispatching.</strong> One way to implement cross-type operations is to select behavior based on the types of the arguments to a function or method. The idea of type dispatching is to write functions that inspect the type of arguments they receive, then execute code that is appropriate for those types.</p>
<p>The built-in function <code>isinstance</code> takes an object and a class. It returns true if the object has a class that either is or inherits from the given class.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>c = ComplexRI(<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">isinstance</span>(c, ComplexRI)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">isinstance</span>(c, Complex)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">isinstance</span>(c, ComplexMA)</span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure>
<p>用<code>isinstance</code>是一种判别方法，也可以使用<code>type_tag</code>变量来标记类型</p>
<p>For arithmetic, we will give a <code>type_tag</code>attribute to <code>Rational</code> and <code>Complex</code> instances that has a string value. When two values <code>x</code> and <code>y</code> have the same <code>type_tag</code>, then we can combine them directly with <code>x.add(y)</code>. If not, we need a cross-type operation.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Rational.type_tag = <span class="string">&#x27;rat&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Complex.type_tag = <span class="string">&#x27;com&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Rational(<span class="number">2</span>, <span class="number">5</span>).type_tag == Rational(<span class="number">1</span>, <span class="number">2</span>).type_tag</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ComplexRI(<span class="number">1</span>, <span class="number">1</span>).type_tag == ComplexMA(<span class="number">2</span>, pi/<span class="number">2</span>).type_tag</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Rational(<span class="number">2</span>, <span class="number">5</span>).type_tag == ComplexRI(<span class="number">1</span>, <span class="number">1</span>).type_tag</span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">add_complex_and_rational</span>(<span class="params">c, r</span>):</span></span><br><span class="line">        <span class="keyword">return</span> ComplexRI(c.real + r.numer/r.denom, c.imag)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">mul_complex_and_rational</span>(<span class="params">c, r</span>):</span></span><br><span class="line">        r_magnitude, r_angle = r.numer/r.denom, <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> r_magnitude &lt; <span class="number">0</span>:</span><br><span class="line">            r_magnitude, r_angle = -r_magnitude, pi</span><br><span class="line">        <span class="keyword">return</span> ComplexMA(c.magnitude * r_magnitude, c.angle + r_angle)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">add_rational_and_complex</span>(<span class="params">r, c</span>):</span></span><br><span class="line">        <span class="keyword">return</span> add_complex_and_rational(c, r)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">mul_rational_and_complex</span>(<span class="params">r, c</span>):</span></span><br><span class="line">        <span class="keyword">return</span> mul_complex_and_rational(c, r)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Number</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__add__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">            <span class="keyword">if</span> self.type_tag == other.type_tag:</span><br><span class="line">                <span class="keyword">return</span> self.add(other)</span><br><span class="line">            <span class="keyword">elif</span> (self.type_tag, other.type_tag) <span class="keyword">in</span> self.adders:</span><br><span class="line">                <span class="keyword">return</span> self.cross_apply(other, self.adders)</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__mul__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">            <span class="keyword">if</span> self.type_tag == other.type_tag:</span><br><span class="line">                <span class="keyword">return</span> self.mul(other)</span><br><span class="line">            <span class="keyword">elif</span> (self.type_tag, other.type_tag) <span class="keyword">in</span> self.multipliers:</span><br><span class="line">                <span class="keyword">return</span> self.cross_apply(other, self.multipliers)</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">cross_apply</span>(<span class="params">self, other, cross_fns</span>):</span></span><br><span class="line">            cross_fn = cross_fns[(self.type_tag, other.type_tag)]</span><br><span class="line">            <span class="keyword">return</span> cross_fn(self, other)</span><br><span class="line">        adders = &#123;(<span class="string">&quot;com&quot;</span>, <span class="string">&quot;rat&quot;</span>): add_complex_and_rational,</span><br><span class="line">                  (<span class="string">&quot;rat&quot;</span>, <span class="string">&quot;com&quot;</span>): add_rational_and_complex&#125;</span><br><span class="line">        multipliers = &#123;(<span class="string">&quot;com&quot;</span>, <span class="string">&quot;rat&quot;</span>): mul_complex_and_rational,</span><br><span class="line">                       (<span class="string">&quot;rat&quot;</span>, <span class="string">&quot;com&quot;</span>): mul_rational_and_complex&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>The role of type dispatching is to ensure that these cross-type operations are used at appropriate times.</p>
<p>In this new definition of the <code>Number</code> class, all cross-type implementations are indexed by pairs of type tags in the <code>adders</code> and <code>multipliers</code> dictionaries.</p>
<p>This dictionary-based approach to type dispatching is extensible. New subclasses of <code>Number</code> could install themselves into the system by declaring a type tag and adding cross-type operations to <code>Number.adders</code> and <code>Number.multipliers</code>. They could also define their own <code>adders</code> and <code>multipliers</code> in a subclass.</p>
<p><strong>Coercion.</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">rational_to_complex</span>(<span class="params">r</span>):</span></span><br><span class="line">  			<span class="string">&#x27;&#x27;&#x27;rational number to complex number</span></span><br><span class="line"><span class="string">  			&#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> ComplexRI(r.numer/r.denom, <span class="number">0</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Number</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__add__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">            x, y = self.coerce(other)</span><br><span class="line">            <span class="keyword">return</span> x.add(y)</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__mul__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">            x, y = self.coerce(other)</span><br><span class="line">            <span class="keyword">return</span> x.mul(y)</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">coerce</span>(<span class="params">self, other</span>):</span></span><br><span class="line">            <span class="keyword">if</span> self.type_tag == other.type_tag:</span><br><span class="line">                <span class="keyword">return</span> self, other</span><br><span class="line">            <span class="keyword">elif</span> (self.type_tag, other.type_tag) <span class="keyword">in</span> self.coercions:</span><br><span class="line">                <span class="keyword">return</span> (self.coerce_to(other.type_tag), other)</span><br><span class="line">            <span class="keyword">elif</span> (other.type_tag, self.type_tag) <span class="keyword">in</span> self.coercions:</span><br><span class="line">                <span class="keyword">return</span> (self, other.coerce_to(self.type_tag))</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">coerce_to</span>(<span class="params">self, other_tag</span>):</span></span><br><span class="line">            coercion_fn = self.coercions[(self.type_tag, other_tag)]</span><br><span class="line">            <span class="keyword">return</span> coercion_fn(self)</span><br><span class="line">        coercions = &#123;(<span class="string">&#x27;rat&#x27;</span>, <span class="string">&#x27;com&#x27;</span>): rational_to_complex&#125;</span><br></pre></td></tr></table></figure>
<p>This coercion scheme has some advantages over the method of defining explicit cross-type operations. Although we still need to write coercion functions to relate the types, we need to write only one function for each pair of types rather than a different function for each set of types and each generic operation.(比上面的方法，代码量少了很多)</p>
<p>Further advantages come from extending coercion. Some more sophisticated coercion schemes do not just try to coerce one type into another, but instead may try to coerce two different types each into a third common type. Consider a rhombus and a rectangle: neither is a special case of the other, but both can be viewed as quadrilaterals. Another extension to coercion is iterative coercion, in which one data type is coerced into another via intermediate types. Consider that an integer can be converted into a real number by first converting it into a rational number, then converting that rational number into a real number. Chaining coercion in this way can reduce the total number of coercion functions that are required by a program.</p>
<p>Despite its advantages, coercion does have potential drawbacks. For one, coercion functions can lose information when they are applied.</p>
<h2 id="recursive-objects">Recursive Objects</h2>
<p>解释下：</p>
<p>Objects can have other objects as attribute values. When an object of some（某个） class has an attribute value of that same class, it is a recursive object.</p>
<h3 id="linked-list-class">Linked List Class</h3>
<p>A linked list, introduced earlier in this chapter, is composed of a first element and the rest of the list. The rest of a linked list is itself a linked list — a recursive definition.</p>
<p>例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Link</span>:</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;A linked list with a first element and the rest.&quot;&quot;&quot;</span></span><br><span class="line">        empty = ()</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, first, rest=empty</span>):</span></span><br><span class="line">            <span class="keyword">assert</span> rest <span class="keyword">is</span> Link.empty <span class="keyword">or</span> <span class="built_in">isinstance</span>(rest, Link)</span><br><span class="line">            self.first = first</span><br><span class="line">            self.rest = rest</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span>(<span class="params">self, i</span>):</span></span><br><span class="line">            <span class="keyword">if</span> i == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">return</span> self.first</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> self.rest[i-<span class="number">1</span>]</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__len__</span>(<span class="params">self</span>):</span></span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span> + <span class="built_in">len</span>(self.rest)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = Link(<span class="number">3</span>, Link(<span class="number">4</span>, Link(<span class="number">5</span>)))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">len</span>(s)</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s[<span class="number">1</span>]</span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">link_expression</span>(<span class="params">s</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;Return a string that would evaluate to s.</span></span><br><span class="line"><span class="string">        	 用来帮助debug</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> s.rest <span class="keyword">is</span> Link.empty:</span><br><span class="line">            rest = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            rest = <span class="string">&#x27;, &#x27;</span> + link_expression(s.rest)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Link(&#123;0&#125;&#123;1&#125;)&#x27;</span>.<span class="built_in">format</span>(s.first, rest)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>link_expression(s)</span><br><span class="line"><span class="string">&#x27;Link(3, Link(4, Link(5)))&#x27;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Link.__repr__ = link_expression</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s <span class="comment"># 跟repr(s)的结果一致</span></span><br><span class="line">Link(<span class="number">3</span>, Link(<span class="number">4</span>, Link(<span class="number">5</span>)))</span><br></pre></td></tr></table></figure>
<p>Python displays instances of user-defined classes by invoking their <code>__repr__</code> method.</p>
<p>The <code>Link</code> class has the closure property.（闭包属性） Just as an element of a list can itself be a list, a <code>Link</code> can contain a <code>Link</code> as its <code>first</code> element.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; s_first &#x3D; Link(s, Link(6))</span><br><span class="line">&gt;&gt;&gt; s_first</span><br><span class="line">Link(Link(3, Link(4, Link(5))), Link(6))</span><br></pre></td></tr></table></figure>
<p>The <code>s_first</code> linked list has only two elements, but its first element is a linked list with three elements.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">len</span>(s_first)</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">len</span>(s_first[<span class="number">0</span>])</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s_first[<span class="number">0</span>][<span class="number">2</span>]</span><br><span class="line"><span class="number">5</span></span><br></pre></td></tr></table></figure>
<p>递归函数天然的适合这种递归对象</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">extend_link</span>(<span class="params">s, t</span>):</span></span><br><span class="line">        <span class="keyword">if</span> s <span class="keyword">is</span> Link.empty:</span><br><span class="line">            <span class="keyword">return</span> t</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> Link(s.first, extend_link(s.rest, t))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>extend_link(s, s)</span><br><span class="line">Link(<span class="number">3</span>, Link(<span class="number">4</span>, Link(<span class="number">5</span>, Link(<span class="number">3</span>, Link(<span class="number">4</span>, Link(<span class="number">5</span>))))))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Link.__add__ = extend_link</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s + s</span><br><span class="line">Link(<span class="number">3</span>, Link(<span class="number">4</span>, Link(<span class="number">5</span>, Link(<span class="number">3</span>, Link(<span class="number">4</span>, Link(<span class="number">5</span>))))))</span><br></pre></td></tr></table></figure>
<h3 id="tree-class">Tree Class</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Tree</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, label, branches=(<span class="params"></span>)</span>):</span></span><br><span class="line">            self.label = label</span><br><span class="line">            <span class="keyword">for</span> branch <span class="keyword">in</span> branches:</span><br><span class="line">                <span class="keyword">assert</span> <span class="built_in">isinstance</span>(branch, Tree)</span><br><span class="line">            self.branches = branches</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span>(<span class="params">self</span>):</span></span><br><span class="line">            <span class="keyword">if</span> self.branches:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;Tree(&#123;0&#125;, &#123;1&#125;)&#x27;</span>.<span class="built_in">format</span>(self.label, <span class="built_in">repr</span>(self.branches))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;Tree(&#123;0&#125;)&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">repr</span>(self.label))</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">is_leaf</span>(<span class="params">self</span>):</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">not</span> self.branches</span><br></pre></td></tr></table></figure>
<p>生成一个 Fibonacci Tree(斐波那契数列树)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">fib_tree</span>(<span class="params">n</span>):</span></span><br><span class="line">        <span class="keyword">if</span> n == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> Tree(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">elif</span> n == <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">return</span> Tree(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            left = fib_tree(n-<span class="number">2</span>)</span><br><span class="line">            right = fib_tree(n-<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span> Tree(left.label + right.label, (left, right))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fib_tree(<span class="number">5</span>)</span><br><span class="line">Tree(<span class="number">3</span>, (Tree(<span class="number">1</span>, (Tree(<span class="number">0</span>), Tree(<span class="number">1</span>))), Tree(<span class="number">2</span>, (Tree(<span class="number">1</span>), Tree(<span class="number">1</span>, (Tree(<span class="number">0</span>), Tree(<span class="number">1</span>)))))))</span><br></pre></td></tr></table></figure>
<h3 id="sets">Sets</h3>
<p>特点：无序，不可重复，set里的元素不可修改(immutable)</p>
<p>用上述两种数据结构构建一个 <code>set</code></p>
<p><strong>List 构建</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">empty</span>(<span class="params">s</span>):</span></span><br><span class="line">        <span class="keyword">return</span> s <span class="keyword">is</span> Link.empty</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">set_contains</span>(<span class="params">s, v</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;Return True if and only if set s contains v.&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> empty(s):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">elif</span> s.first == v:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> set_contains(s.rest, v)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = Link(<span class="number">4</span>, Link(<span class="number">1</span>, Link(<span class="number">5</span>)))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>set_contains(s, <span class="number">2</span>)</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>set_contains(s, <span class="number">5</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">adjoin_set</span>(<span class="params">s, v</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;Return a set containing all elements of s and element v.&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> set_contains(s, v):</span><br><span class="line">            <span class="keyword">return</span> s</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> Link(v, s)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t = adjoin_set(s, <span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t</span><br><span class="line">Link(<span class="number">2</span>, Link(<span class="number">4</span>, Link(<span class="number">1</span>, Link(<span class="number">5</span>))))</span><br></pre></td></tr></table></figure>
<p>用list构建，时间复杂度上会比较多高；插入一个元素，需要O(n)，如果元素有序后，可以用二分查找，降到O(logn)；</p>
<p><strong>Tree构建</strong></p>
<p>用树构建，可以用二叉搜索树构建，利用其特点，将时间复杂度降下来，比如插入元素就是O(logn)了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">set_contains</span>(<span class="params">s, v</span>):</span></span><br><span class="line">        <span class="keyword">if</span> s <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">elif</span> s.entry == v:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">elif</span> s.entry &lt; v:</span><br><span class="line">            <span class="keyword">return</span> set_contains(s.right, v)</span><br><span class="line">        <span class="keyword">elif</span> s.entry &gt; v:</span><br><span class="line">            <span class="keyword">return</span> set_contains(s.left, v)</span><br></pre></td></tr></table></figure>
<p><strong>Python set implementation.</strong> The <code>set</code> type that is built into Python does not use any of these representations internally. Instead, Python uses a representation that gives constant-time membership tests and adjoin operations based on a technique called <em>hashing</em>.</p>
<h2 id="efficiency">Efficiency</h2>
<h3 id="measuring-efficiency">Measuring Efficiency</h3>
<p>定义一个高阶函数来计算某个函数调用的次数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">count</span>(<span class="params">f</span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">counted</span>(<span class="params">*args</span>):</span></span><br><span class="line">            counted.call_count += <span class="number">1</span></span><br><span class="line">            <span class="keyword">return</span> f(*args)</span><br><span class="line">        counted.call_count = <span class="number">0</span></span><br><span class="line">        <span class="keyword">return</span> counted</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">fib</span>(<span class="params">n</span>):</span></span><br><span class="line">        <span class="keyword">if</span> n == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> n == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> fib(n-<span class="number">2</span>) + fib(n-<span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fib(<span class="number">5</span>)</span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fib = count(fib)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fib(<span class="number">19</span>)</span><br><span class="line"><span class="number">4181</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fib.call_count</span><br><span class="line"><span class="number">13529</span></span><br></pre></td></tr></table></figure>
<p><strong>Space.</strong> 当一个frame处于active状态，这个frame就在占用内存，处于active状态就是有函数调用或者数据处理等。当frame处于inactive状态时，python会自动收回它使用的内存。An environment is active if it provides the evaluation context for some expression being evaluated. An environment becomes inactive whenever the function call for which its first frame was created finally returns.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">count_frames</span>(<span class="params">f</span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">counted</span>(<span class="params">*args</span>):</span></span><br><span class="line">            counted.open_count += <span class="number">1</span></span><br><span class="line">            counted.max_count = <span class="built_in">max</span>(counted.max_count, counted.open_count)</span><br><span class="line">            result = f(*args)</span><br><span class="line">            counted.open_count -= <span class="number">1</span></span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        counted.open_count = <span class="number">0</span></span><br><span class="line">        counted.max_count = <span class="number">0</span></span><br><span class="line">        <span class="keyword">return</span> counted</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fib = count_frames(fib)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fib(<span class="number">19</span>)</span><br><span class="line"><span class="number">4181</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fib.open_count</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fib.max_count</span><br><span class="line"><span class="number">19</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fib(<span class="number">24</span>)</span><br><span class="line"><span class="number">46368</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>fib.max_count</span><br><span class="line"><span class="number">24</span></span><br></pre></td></tr></table></figure>
<p>上述高阶函数统计最大同时使用的frame数。</p>
<p>To summarize, the space requirement of the <code>fib</code> function, measured in active frames, is one less than the input, which tends to be small. The time requirement measured in total recursive calls is larger than the output, which tends to be huge.</p>
<h3 id="memoization">Memoization</h3>
<p>由于fib函数在计算的过程中，有许多需要重复计算的部分，所以可以使用一个字典来保存已经计算过的部分。</p>
<p>Memoization can be expressed naturally as a higher-order function, which can also be used as a decorator. The definition below creates a <em>cache</em> of previously computed results, indexed by the arguments from which they were computed. The use of a dictionary requires that the argument to the memoized function be immutable.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">memo</span>(<span class="params">f</span>):</span></span><br><span class="line">  			<span class="string">&#x27;&#x27;&#x27;缓存</span></span><br><span class="line"><span class="string">  			&#x27;&#x27;&#x27;</span></span><br><span class="line">        cache = &#123;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">memoized</span>(<span class="params">n</span>):</span></span><br><span class="line">            <span class="keyword">if</span> n <span class="keyword">not</span> <span class="keyword">in</span> cache:</span><br><span class="line">                cache[n] = f(n)</span><br><span class="line">            <span class="keyword">return</span> cache[n]</span><br><span class="line">        <span class="keyword">return</span> memoized</span><br></pre></td></tr></table></figure>
<h2 id="decomposition">Decomposition</h2>
<h3 id="modules">Modules</h3>
<p>A <a target="_blank" rel="noopener" href="https://docs.python.org/3/tutorial/modules.html">Python module</a> is a file typically containing function or class definitions.</p>
<p>例子：</p>
<p>link.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Link</span>:</span></span><br><span class="line">    empty = ()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, first, rest=empty</span>):</span></span><br><span class="line">        <span class="keyword">assert</span> rest <span class="keyword">is</span> Link.empty <span class="keyword">or</span> <span class="built_in">isinstance</span>(rest, Link)</span><br><span class="line">        self.first = first</span><br><span class="line">        self.rest = rest</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">if</span> self.rest:</span><br><span class="line">            rest_repr = <span class="string">&#x27;, &#x27;</span> + <span class="built_in">repr</span>(self.rest)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            rest_repr = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Link(&#x27;</span> + <span class="built_in">repr</span>(self.first) + rest_repr + <span class="string">&#x27;)&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        string = <span class="string">&#x27;&lt;&#x27;</span></span><br><span class="line">        <span class="keyword">while</span> self.rest <span class="keyword">is</span> <span class="keyword">not</span> Link.empty:</span><br><span class="line">            string += <span class="built_in">str</span>(self.first) + <span class="string">&#x27; &#x27;</span></span><br><span class="line">            self = self.rest</span><br><span class="line">        <span class="keyword">return</span> string + <span class="built_in">str</span>(self.first) + <span class="string">&#x27;&gt;&#x27;</span></span><br></pre></td></tr></table></figure>
<h4 id="importing">Importing</h4>
<p>Importing a whole module:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> link</span><br><span class="line"></span><br><span class="line">ll = link.Link(<span class="number">3</span>, link.Link(<span class="number">4</span>, link.Link(<span class="number">5</span>)))</span><br></pre></td></tr></table></figure>
<p>Importing specific names:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> link <span class="keyword">import</span> Link</span><br><span class="line"></span><br><span class="line">ll = Link(<span class="number">3</span>, Link(<span class="number">4</span>, Link(<span class="number">5</span>)))</span><br></pre></td></tr></table></figure>
<p>Importing all names:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> link <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">ll = Link(<span class="number">3</span>, Link(<span class="number">4</span>, Link(<span class="number">5</span>)))</span><br></pre></td></tr></table></figure>
<h4 id="importing-with-alias">Importing with alias</h4>
<p>I don't recommend aliasing a class or function name:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> link <span class="keyword">import</span> Link <span class="keyword">as</span> LL</span><br><span class="line"></span><br><span class="line">ll = LL(<span class="number">3</span>, LL(<span class="number">4</span>, LL(<span class="number">5</span>)))</span><br></pre></td></tr></table></figure>
<p>But aliasing a whole module is sometimes okay (and is common in data science):</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">b = np.array([(<span class="number">1.5</span>, <span class="number">2</span>, <span class="number">3</span>), (<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>)])</span><br></pre></td></tr></table></figure>
<h4 id="running-a-module">Running a module</h4>
<p>This command runs a module:</p>
<p><code>python module.py</code></p>
<p>When run like that, Python sets a global variable <code>__name__</code> to "main". That means you often see code at the bottom of modules like this:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># use the code in the module somehow</span></span><br></pre></td></tr></table></figure>
<p>The code inside that condition will be executed as well, but only when the module is run directly.(只有直接运行该module时才会执行<code>__main__</code>这个里的内容，如果在其他文件中<code>import</code>里这个module，则该module里的<code>__main__</code>里的内容不会运行)</p>
<h3 id="packages">Packages</h3>
<h4 id="python-packages">Python packages</h4>
<p>A <a target="_blank" rel="noopener" href="https://docs.python.org/3/tutorial/modules.html#packages">Python package</a> is a way of bundling multiple related modules together. Popular packages are NumPy and Pillow.</p>
<p>Example package structure:</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">sound&#x2F;                        top-level package</span><br><span class="line">    __init__.py               初始化这个sound package</span><br><span class="line">    formats&#x2F;                  子包：文件格式转换</span><br><span class="line">            __init__.py</span><br><span class="line">            wavread.py</span><br><span class="line">            wavwrite.py</span><br><span class="line">            aiffread.py</span><br><span class="line">            aiffwrite.py</span><br><span class="line">            auread.py</span><br><span class="line">            auwrite.py</span><br><span class="line">            ...</span><br><span class="line">    effects&#x2F;                  Subpackage for sound effects</span><br><span class="line">            __init__.py</span><br><span class="line">            echo.py</span><br><span class="line">            surround.py</span><br><span class="line">            reverse.py</span><br><span class="line">            ...</span><br><span class="line">    filters&#x2F;                  Subpackage for filters</span><br><span class="line">            __init__.py</span><br><span class="line">            equalizer.py</span><br><span class="line">            vocoder.py</span><br><span class="line">            karaoke.py</span><br><span class="line">            ...</span><br></pre></td></tr></table></figure>
<p>其中<code>__init__.py</code>可以是个空文件</p>
<h4 id="importing-from-a-package">Importing from a package</h4>
<p>Importing a whole path:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sound.effects.echo</span><br><span class="line"></span><br><span class="line">sound.effects.echo.echofilter(<span class="built_in">input</span>, output, delay=<span class="number">0.7</span>, atten=<span class="number">4</span>)</span><br></pre></td></tr></table></figure>
<p>Importing a module from the path:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sound.effects <span class="keyword">import</span> echo</span><br><span class="line"></span><br><span class="line">echo.echofilter(<span class="built_in">input</span>, output, delay=<span class="number">0.7</span>, atten=<span class="number">4</span>)</span><br></pre></td></tr></table></figure>
<h4 id="installing-packages">Installing packages</h4>
<p>The <a target="_blank" rel="noopener" href="https://pypi.org/">Python Package Index</a> is a repository of packages for the Python language.</p>
<p>Once you find a package you like, <code>pip</code> is the standard way to install:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install nltk</span><br></pre></td></tr></table></figure>
<p>You may need to use <code>pip3</code> if your system defaults to Python 2.</p>
<h3 id="modularity">Modularity</h3>
<h4 id="modular-design">Modular design</h4>
<p>A design principle: Isolate different parts of a program that address different concerns.</p>
<p>A modular component can be developed and tested independently.</p>
<p>Ways to isolate in Python:</p>
<ul>
<li>Functions</li>
<li>Classes</li>
<li>Modules</li>
<li>Packages</li>
</ul>
<h1 id="interpreting-computer-programs">Interpreting Computer Programs</h1>
<p>上面两个部分讲的都是去用python这个语言，下面这部分讲如何设计一个编程语言，此时，咱们的角度要从使用者变为设计者。</p>
<p>这部分主要为<code>Scheme(是一种计算机语言，比较古老，也叫Lisp)</code>写一个编译器。</p>
<h2 id="interpreters-for-languages-with-combination">Interpreters for Languages with Combination</h2>
<p>先实现部分<code>scheme编译器</code>的功能，然后在实现一个通用的编译器。</p>
<h3 id="a-scheme-syntax-calculator">A Scheme-Syntax Calculator</h3>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>秃头的小刺猬
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="http://narutojian.github.io/2022/05/01/cs61A-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="2021 fall cs61A 学习笔记">http://narutojian.github.io/2022/05/01/cs61A-学习笔记/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/cs61A/" rel="tag"><i class="fa fa-tag"></i> cs61A</a>
              <a href="/tags/python/" rel="tag"><i class="fa fa-tag"></i> python</a>
              <a href="/tags/%E7%AC%94%E8%AE%B0/" rel="tag"><i class="fa fa-tag"></i> 笔记</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/04/30/Java%E9%97%AE%E9%A2%98%E5%A4%87%E5%BF%98%E5%BD%95/" rel="prev" title="Java问题备忘录">
                  <i class="fa fa-chevron-left"></i> Java问题备忘录
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/05/06/%E7%A0%94%E7%A9%B6%E7%94%9F%E5%85%A5%E5%AD%A6%E6%A1%A3%E6%A1%88%E8%B0%83%E5%8A%A8%E6%B5%81%E7%A8%8B/" rel="next" title="研究生入学档案调动流程">
                  研究生入学档案调动流程 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2020 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class=""></i>
  </span>
  <span class="author" itemprop="copyrightHolder">秃头的小刺猬</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">105k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">11:41</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  





  




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
